<div id="komet_mapping_section_<%= @viewer_id %>">

    <div id="komet_mapping_set_panel_<%= @viewer_id %>" class="komet-mapping-section-panel">

        <!-- main header block - always visible -->
        <div class="komet-mapping-section-panel-header">

            <!-- Title -->
            <div class="komet-mapping-section-panel-title">
                Map Set Details
            </div>

            <div class="komet-mapping-section-panel-tools komet-flex-right">

                <!-- expand/collapse icon - controls details drawer -->
                <div class="glyphicon glyphicon-minus-sign" onclick="WindowManager.viewers[<%= @viewer_id %>].togglePanelDetails('komet_mapping_set_panel_<%= @viewer_id %>', null, true)"></div>
            </div>

        </div>


        <%= form_tag(mapping_process_map_set_path, method: 'post', id: "komet_mapping_set_editor_form_#{@viewer_id}", class: 'komet-mapping-set-details-form komet-mapping-section-panel-details') do %>

            <%= hidden_field_tag :komet_mapping_set_editor_set_id, @map_set[:set_id], id: "komet_mapping_set_editor_set_id_#{@viewer_id}" %>

            <div class="komet-mapping-set-definition-row">

                <div class="komet-mapping-set-definition-header">
                    <%= label_tag nil, 'Version:' %> <%= @map_set[:version] %>
                </div>

                <div class="komet-mapping-set-definition-header">
                    <%= label_tag nil, 'VUID:' %> <%= @map_set[:vuid] %>
                </div>

                <div class="komet-mapping-set-definition-controls">
                    <button class="btn btn-primary komet-mapping-set-editor-display" type="button" onclick="WindowManager.viewers[<%= @viewer_id %>].enterSetEditMode()">Edit</button>
                    <button class="btn btn-default komet-mapping-set-editor-edit" type="button" onclick="WindowManager.viewers[<%= @viewer_id %>].cancelSetEditMode('<%= @previous_set_id %>')">Cancel</button>
                    <button class="btn btn-primary komet-mapping-set-editor-edit" id="komet_mapping_set_editor_save_<%= @viewer_id %>">Save</button>
                </div>
            </div>

            <div id="komet_mapping_set_tabs_<%= @viewer_id %>" class="komet-mapping-set-tabs">

                <ul>
                    <li><a href='#komet_mapping_set_definition_tab_<%= @viewer_id %>' title="Definition">Definition</a></li>
                    <li><a href='#komet_mapping_set_items_tab_<%= @viewer_id %>' title="Item Fields">Item Fields</a></li>
                    <li><a href='#komet_mapping_set_rules_tab_<%= @viewer_id %>' title="Business Rules">Business Rules</a></li>
                </ul>

                <div id="komet_mapping_set_definition_tab_<%= @viewer_id %>" class="komet-mapping-set-tab-body">

                    <!-- add the dialog form for including new fields into a mapset -->
                    <%= render(partial: 'komet_dashboard/add_fields_dialog', locals: {
                        dialog_title: 'Add Set Fields',
                        id_prefix: 'komet_mapping_set_editor_',
                        id_postfix: '_' + @viewer_id,
                        javascript_object: 'WindowManager.viewers[' + @viewer_id + ']',
                        javascript_function_qualifier: 'Set'
                    }) %>

                    <div class="komet-mapping-set-definition-controls">
                        <button class="btn btn-default komet-mapping-set-editor-edit komet-mapping-set-editor-create-only" type="button" onclick="WindowManager.viewers[<%= @viewer_id %>].showIncludeSetFieldsDialog()">Add More Fields</button>
                    </div>

                    <div class="komet-mapping-set-definition-row">

                            <div class="komet-mapping-set-definition-item">
                                <%= label_tag "komet_mapping_set_editor_name_#{@viewer_id}", 'Fully Specified Name:' %>
                                <%= text_field_tag :komet_mapping_set_editor_name, @map_set[:name], id: "komet_mapping_set_editor_name_#{@viewer_id}", class: 'form-control komet-mapping-set-editor-edit' %>
                                <div class="komet-mapping-set-editor-display"><%= @map_set[:name] %></div>
                            </div>

                            <div class="komet-mapping-set-definition-item">
                                <%= label_tag "komet_mapping_set_editor_description_#{@viewer_id}", 'Description:' %>
                                <%= text_field_tag :komet_mapping_set_editor_description, @map_set[:description], id: "komet_mapping_set_editor_description_#{@viewer_id}", class: 'form-control komet-mapping-set-editor-edit' %>
                                <div class="komet-mapping-set-editor-display"><%= @map_set[:description] %></div>
                            </div>

                    </div>

                    <div class="komet-mapping-set-definition-row">

                            <div class="komet-mapping-set-definition-item">
                                <%= label_tag "komet_mapping_set_editor_state_#{@viewer_id}", 'State:' %>
                                <%= select_tag :komet_mapping_set_editor_state, options_for_select([['Active'], ['Inactive']], @map_set[:state]), id: "komet_mapping_set_editor_state_#{@viewer_id}", class: 'form-control komet-mapping-set-editor-edit' %>
                                <div class="komet-mapping-set-editor-display"><%= @map_set[:state] %></div>
                            </div>

                            <div class="komet-mapping-set-definition-item">
                                <%= label_tag "komet_mapping_set_editor_state_#{@viewer_id}", 'Workflow State:' %>
                                <div><%= @map_set[:state] %></div>
                            </div>

                    </div>

                </div>

                <div id="komet_mapping_set_items_tab_<%= @viewer_id %>" class="komet-mapping-set-tab-body">

                    <!-- add the dialog form for including new fields into a mapset -->
                    <%= render(partial: 'komet_dashboard/add_fields_dialog', locals: {
                        dialog_title: 'Add Item Fields',
                        id_prefix: 'komet_mapping_set_editor_items_',
                        id_postfix: '_' + @viewer_id,
                        javascript_object: 'WindowManager.viewers[' + @viewer_id + ']',
                        javascript_function_qualifier: 'SetItems'
                    }) %>

                    <div class="komet-mapping-set-definition-controls">
                        <button class="btn btn-default komet-mapping-set-editor-edit komet-mapping-set-editor-create-only" type="button" onclick="WindowManager.viewers[<%= @viewer_id %>].showIncludeSetItemsFieldsDialog()">Add More Fields to Map Items</button>
                    </div>

                </div>

                <div id="komet_mapping_set_rules_tab_<%= @viewer_id %>" class="komet-mapping-set-tab-body">
                    <%= text_area_tag :komet_mapping_set_editor_rules, @map_set[:rules], id: "komet_mapping_set_editor_rules_#{@viewer_id}", class: 'form-control komet-mapping-set-editor-edit' %>
                    <div class="komet-mapping-set-editor-display"><%= @map_set[:rules] %></div>
                </div>

            </div>

        <% end %>
    </div>

    <% if @mapping_action != 'create_set' %>

        <div id="komet_mapping_item_panel_<%= @viewer_id %>" class="komet-mapping-section-panel">

            <!-- main header block - always visible -->
            <div class="komet-mapping-section-panel-header">

                <!-- Title -->
                <div class="komet-mapping-section-panel-title">
                    Map Items
                </div>

                <div class="komet-mapping-section-panel-tools komet-flex-right">

                    <!-- expand/collapse icon - controls details drawer -->
                    <div class="glyphicon glyphicon-minus-sign" onclick="WindowManager.viewers[<%= @viewer_id %>].togglePanelDetails('komet_mapping_item_panel_<%= @viewer_id %>', null, true)"></div>
                </div>
            </div>

            <div class="komet-mapping-section-panel-header-shelf">

                <div>
                    <div class="input-group">
                        <span class="input-group-addon" ><span class="fa fa-search"></span></span>
                        <input id="komet_mapping_item_filter_<%= @viewer_id %>" class="form-control" placeholder="Type to Search Map Items...">
                    </div>
                </div>

                <select id="komet_mapping_item_filter_by_<%= @viewer_id %>" class="form-control komet-mapping-item-filter-by">
                    <option value="">Filter By:</option>
                    <option value="source_code">Source Code</option>
                    <option value="source_description">Source Description</option>
                    <option value="target_code">Target Code</option>
                    <option value="target_description">Target Description</option>
                    <option value="vuid">VUID</option>
                </select>

                <button class="btn btn-default form-control komet-mapping-item-filter-button">Filter</button>

                <div class="komet-flex-right">

                    <input type="checkbox" id="komet_mapping_item_stamp_<%= @viewer_id %>" onclick="WindowManager.viewers[<%= @viewer_id %>].toggleItemsSTAMP()">
                    <label for="komet_mapping_item_stamp_<%= @viewer_id %>">STAMP</label>

                    <input type="checkbox" id="komet_mapping_item_active_<%= @viewer_id %>" checked onclick="WindowManager.viewers[<%= @viewer_id %>].loadOverviewItemsGrid()">
                    <label for="komet_mapping_item_active_<%= @viewer_id %>">Active</label>

                    <input type="checkbox" id="komet_mapping_item_inactive_<%= @viewer_id %>" onclick="WindowManager.viewers[<%= @viewer_id %>].loadOverviewItemsGrid()">
                    <label for="komet_mapping_item_inactive_<%= @viewer_id %>">Inactive</label>
                </div>
            </div>

            <div class="komet-mapping-section-panel-details">

                <div class="komet-mapping-item-tools">

                    Page Size:
                    <select id="komet_mapping_item_page_size_<%= @viewer_id %>" class="form-control komet-mapping-item-page-size">
                        <option selected>25</option>
                        <option>50</option>
                        <option>100</option>
                        <option>250</option>
                        <option>500</option>
                        <option>1000</option>
                    </select>

                    <div id="komet_mapping_overview_item_create_<%= @viewer_id %>" class="fa fa-plus ui-state-disabled" title="Create New Map Item" onclick="WindowManager.viewers[<%= @viewer_id %>].openItemEditor(true);"></div>
                    <div id="komet_mapping_overview_item_delete_<%= @viewer_id %>" class="fa fa-minus ui-state-disabled" title="Delete Selected Map Item"></div>
                    <div id="komet_mapping_overview_item_edit_<%= @viewer_id %>" class="fa fa-pencil ui-state-disabled" title="Edit Selected Map Item" onclick="WindowManager.viewers[<%= @viewer_id %>].enterItemEditMode();"></div>
                    <div id="komet_mapping_overview_item_comment_<%= @viewer_id %>" class="fa fa-comment ui-state-disabled" title="Edit Comments for Selected Map Item"></div>
                </div>

                <div id="komet_mapping_overview_items_<%= @viewer_id %>" style="height: 450px;" class="ag-fresh"></div>

            </div>

        <% end %>

    </div>

</div>

<script>

  $(document).ready(function () {

      WindowManager.viewers[<%= @viewer_id %>].setEditorMapSet = <%= raw @map_set.to_json %>;
      WindowManager.viewers[<%= @viewer_id %>].initializeSetEditor("<%= @mapping_action %>");
  });

</script>