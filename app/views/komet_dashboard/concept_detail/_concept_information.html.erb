<div class="panel panel-default komet-no-margins komet-panel" id="komet_concept_panel_<%= @viewer_id %>" data-komet-viewer-id="<%= @viewer_id %>">
  <div class="panel-heading">
    <span class="panel-title komet-section-title">
      <span id="komet_concept_panel_tree_link_<%= @viewer_id %>" class="fa fa-chain-broken" onclick="ConceptsModule.toggleLinkToTaxonomy(<%= @viewer_id %>, true);" title="Link to Taxonomy Tree"></span>
      <span id="komet_concept_panel_tree_show_<%= @viewer_id %>" class="fa fa-tree" onclick="ConceptsModule.viewers[<%= @viewer_id %>].showInTaxonomyTree();" title="Show in Taxonomy Tree"></span>
      <%= @attributes[0][:value] %>
    </span>
    <div class="komet-panel-tools">
      <!--<div class="glyphicon glyphicon-new-window"></div>
      <div class="glyphicon glyphicon-resize-full"></div>-->
      <div class="glyphicon glyphicon-remove" onclick="ConceptsModule.closeViewer(<%= @viewer_id %>)"></div>
    </div>
  </div>

  <div class="panel-body">

    <div class="komet-concept-body-tools">
      <div class="glyphicon glyphicon-plus-sign" onclick="ConceptsModule.viewers[<%= @viewer_id %>].togglePanelDetails('komet_concept_panel_<%= @viewer_id %>')"></div>
      <span>Expand All</span>

      <div class="komet-flex-right">
        <select id="komet_concept_stated_inferred_<%= @viewer_id %>" class="form-control komet-stated-inferred" onchange="ConceptsModule.setStatedView(<%= @viewer_id %>, this)">
          <option value="true">Stated View</option>
          <option value="false">Inferred View</option>
        </select>
      </div>
    </div>

    <div id="komet_concept_attributes_section_<%= @viewer_id %>" class="concept-section"></div>
    <div id="komet_concept_descriptions_section_<%= @viewer_id %>" class="concept-section"></div>
    <div id="komet_concept_sememes_section_<%= @viewer_id %>" class="concept-section"></div>
    <div id="komet_concept_lineage_section_<%= @viewer_id %>" class="concept-section"></div>
    <div id="komet_concept_diagram_section_<%= @viewer_id %>" class="concept-section"></div>
    <div id="komet_concept_refsets_section_<%= @viewer_id %>" class="concept-section"></div>

  </div>

  <script>

    if (!ConceptsModule.viewers.hasOwnProperty('<%= @viewer_id %>')) {
      ConceptsModule.createViewer("<%= @viewer_id %>", "<%= @concept_id %>");
    } else {

      ConceptsModule.viewers[<%= @viewer_id %>].currentConceptID = "<%= @concept_id %>";

      if (TaxonomyModule.getLinkedViewerID() == "<%= @viewer_id %>"){
        ConceptsModule.viewers["<%= @viewer_id %>"].swapLinkIcon(true);
      }
    }

    $('#komet_concept_attributes_section_<%= @viewer_id %>').html("<%= j(render(:partial => 'komet_dashboard/concept_detail/concept_attributes')) %>");
    $('#komet_concept_descriptions_section_<%= @viewer_id %>').html("<%= j(render(:partial => 'komet_dashboard/concept_detail/concept_descriptions')) %>");
    $('#komet_concept_sememes_section_<%= @viewer_id %>').html("<%= j(render(:partial => 'komet_dashboard/concept_detail/concept_sememes')) %>");
    $('#komet_concept_lineage_section_<%= @viewer_id %>').html("<%= j(render(:partial => 'komet_dashboard/concept_detail/concept_lineage')) %>");
    $('#komet_concept_diagram_section_<%= @viewer_id %>').html("<%= j(render(:partial => 'komet_dashboard/concept_detail/concept_diagram')) %>");
    $('#komet_concept_refsets_section_<%= @viewer_id %>').html("<%= j(render(:partial => 'komet_dashboard/concept_detail/concept_refsets')) %>");
    $(document).ready(function () {

      $("#komet_concept_stated_inferred_<%= @viewer_id %> option").filter(function() {
        return $(this)[0].value == "<%= @stated %>";
      }).prop('selected', true);

      ConceptsModule.viewers[<%= @viewer_id %>].restorePanelStates();
      ConceptsModule.viewers[<%= @viewer_id %>].loadLineageTrees();
      UIHelper.initializeContextMenus();
    });
  </script>
</div>


